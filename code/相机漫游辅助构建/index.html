<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="../src/three.js"></script>
    <script src="../src/controller/OrbitControls.js"></script>
    <script src="../src/libs/CameraHelper.js"></script>
    <script src="../src/controller/TransformControls.js"></script>
    <style>
        body{
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="Stats-output"></div>
    <div id="WebGL-output"></div>
</body>
<script>


    var cameraPositions = [
        {
            index: 1,
            nextIndex: 2,
            position: {
                x: 5,
                y: 5,
                z: 5
            },
            target: {
                x: 0,
                y: 0,
                z: 0
            },
            duration: 1000
        },
        {
            index: 2,
            nextIndex: -1,
            position: {
                x: -5,
                y: 5,
                z: 5
            },
            target: {
                x: 0,
                y: 0,
                z: 0
            },
            duration: 1000
        }
    ]
    window.onload = function(){
        let scene = new THREE.Scene()
        let camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        let renderer = new THREE.WebGLRenderer({
            antialias:true, // 开启抗锯齿处理
            alpha:true
        })
        renderer.setClearColor(new THREE.Color(0xEEEEEE))
        renderer.setSize(window.innerWidth,window.innerHeight)
        renderer.shadowMap.enabled = true
        let domElement = renderer.domElement

        var controller = new THREE.OrbitControls( camera, domElement )
        camera.position.x = -30
        camera.position.y = 40
        camera.position.z = 30
        camera.lookAt(scene.position)

        var normalMaterial = new THREE.MeshNormalMaterial()

        // var camera2 = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 5)
        // camera2.position.x = 0
        // camera2.position.y = 10
        // camera2.position.z = 0
        // var sphere2 = new THREE.Mesh(new THREE.SphereBufferGeometry(1,16,16), normalMaterial);
        // sphere2.isSelected = false
        // sphere2.userData.isParent = true
        // camera2.add(sphere2)
        // scene.add(camera2)

        // var helper = new THREE.CameraHelper( camera2 );
        // scene.add(helper)

        var geometry
        for(var i=0;i < cameraPositions.length;i++) {
            console.log(1)
            var item = cameraPositions[i]
            item.camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 5)
            item.camera.position.x = item.position.x
            item.camera.position.y = item.position.y
            item.camera.position.z = item.position.z
            // item.camera.lookAt(0,0,0)
            // console.log(item.target.x, item.target.y, item.target.z)
            item.camera.lookAt(item.target.x, item.target.y, item.target.z)
            // var sphere2 = new THREE.Mesh(new THREE.SphereBufferGeometry(1,16,16), normalMaterial);
            // sphere2.isSelected = false
            // sphere2.userData.isParent = true
            // camera2.add(sphere2)
            scene.add(item.camera)

            item.transformControls = new THREE.TransformControls(camera, domElement);
            item.transformControls.setMode('translate')
            item.transformControls.attach(item.camera)
            scene.add(item.transformControls)

            if(item.nextIndex > 0) {
                geometry = new THREE.Geometry();
                geometry.vertices.push(
                    new THREE.Vector3( item.position.x, item.position.y, item.position.z ),
                    new THREE.Vector3( cameraPositions[i+1].position.x, cameraPositions[i+1].position.y, cameraPositions[i+1].position.z )
                );
                var line = new THREE.Line(geometry, new THREE.LineBasicMaterial({color: 0x0000ff}))
                item.line = line
                scene.add(line)
            }

            var helper = new THREE.CameraHelper( item.camera );
            scene.add(helper)
        }

       
        var grid = new THREE.GridHelper( 30, 30, 0x444444, 0x888888 );
	    scene.add( grid );

        document.getElementById('WebGL-output').appendChild(domElement)
        
        renderScene()
        function renderScene(){
            // camera2.position.x += 0.05
            // camera2.rotation.y += 0.01
            renderer.render(scene,camera)
            requestAnimationFrame(renderScene)
        }
        window.onresize = onResize
        function onResize(){
            camera.aspect = window.innerWidth / window.innerHeight
            camera.updateProjectionMatrix()
            renderer.setSize(window.innerWidth,window.innerHeight)
        }
        
}
    
</script>
</html>